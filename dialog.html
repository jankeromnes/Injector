<!doctype html>
<meta charset=utf8>
<title>dialog</title>
<style>
  .slide {
    text-align: center;
    margin: 0 auto;
    display: none;
    position: absolute;
    width: 100%;
    height: 100%;
  }
  input[type=submit], input[type=button]{
    width: 20%;
    height: 100%;
    background: white;
    font-size: 2em;
    color: lightgrey;
    border: 0;
    float: left;
  }
  div.central {
    height: 100%;
    padding-top: 15%;
    margin: auto;
    width: 60%;
    float: left;
  }
</style>

<form id=screen1 class="slide" action="javascript:next()">
  <input type=button>
  <div class=central>
    <p>Who is the letter recipient?
    <p>
    <select name=civility>
      <option value=MISS>Miss</option>
      <option value=MADAM>Mrs</option>
      <option value=MISTER>Mister</option>
    </select>
    <input name=firstName placeholder="First name">
    <input name=lastName placeholder="Last name">
  </div>
  <input type=submit value=&gt;>
</form>

<form id=screen2 class=slide action="javascript:next()">
  <input type=button value=&lt; onclick="previous();">
  <div class=central>
    <p>What language does she speak?
    <p>
    <select name=language>
      <option value=LANG_en>English</option>
      <option value=LANG_fr>French</option>
      <option value=LANG_de>German</option>
    </select>
  </div>
  <input type=submit value=&gt;>
</form>

<form id=screen3 class=slide action="javascript:next()">
  <input type=button value=&lt; onclick="previous();">
  <div class=central>
    <p>How old is she?
    <input name=age placeholder=Age size=7>
  </div>
  <input type=submit value=&gt;>
</form>

<form id=screen4 class=slide action="javascript:next()">
  <input type=button value=&lt; onclick="previous();">
  <div class=central>
    <p>Has she children?
    <p>
    <input type=radio name=hasChildren value=true>yes
    <input type=radio name=hasChildren value=false>no
  </div>
  <input type=submit value=&gt;>
</form>

<form id=screen5 class=slide action="javascript:next()">
  <input type=button value=&lt; onclick="previous();">
  <div class=central>
    <p>What was the amount of her savings?
    <p><input name=amount placeholder="Savings amount">
  </div>
  <input type=submit value=&gt;>
</form>

<form id=screen6 class=slide action="javascript:next()">
  <input type=button value=&lt; onclick="previous();">
  <div class=central>
    <p>Is she a regular buyer?
    <p>
    <input type=radio name=regularBuyer value=true>yes
    <input type=radio name=regularBuyer value=false>no
  </div>
  <input type=submit value=&gt;>
</form>

<form id=screen7 class=slide action="javascript:void 0">
  <input type=button value=&lt; onclick="previous();">
  <div class=central>
    <p>What will be the amount of her gift voucher?
    <p><input name=giftValue placeholder="Voucher amount">
  </div>
  <input type=submit value=&gt;>
</form>

<div id=result class=slide>
  <input type=button value=&lt; onclick="start();">
  <div id=content class=central>
  </div>
  <input type=hidden>
</div>

<script src=js/jquery-1.6.2.min.js></script>
<script src=js/jquery-ui-1.8.16.custom.min.js></script>
<script src=js/spin.js></script>
<script src=js/scout.js></script>

<script>
  // firstName lastName civility age hasChildren amount regularBuyer giftValue

  var current = 1, data = {};

  function start() {
    current = 1;
    $('#result').hide('slide', { direction: 'left'}, 1000);
    $('#screen1').show('slide', { direction: 'right' }, 1000);
  }

  function next() {
    var screen = Scout('#screen'+current);
    for ( var key in screen.elements) {
      if (screen[key] && screen[key].name) {
        data[screen[key].name] = screen[key].value;
      } 
    }
    console.log(data);
    $('#screen'+(current++)).hide('slide', { direction: 'left' }, 1000);
    $('#screen'+current).show('slide', { direction: 'right' }, 1000);
  };

  function previous() {
    $('#screen'+(current--)).hide('slide', { direction: 'right' }, 1000);
    $('#screen'+current).show('slide', { direction: 'left' }, 1000);
  };
  
  Scout('#screen7').on ('submit', function (query) {

    var screen = Scout('#screen7');
    for ( var key in screen.elements) {
      if (screen[key] && screen[key].name) {
        data[screen[key].name] = screen[key].value;
      } 
    }
    $('#screen7').hide('slide', { direction: 'left' }, 1000);
    $('#result').show('slide', { direction: 'right' }, 1000);

    var spinner = new Spinner().spin();
    Scout('#content').appendChild(spinner.el);

    console.log('sending\n', JSON.stringify(data));

    query.action = 'englishLetter';
    query.data = data;
    query.resp = function (output) {
      console.log('received:\n'+output);
      Scout('#content').innerHTML = output;
    };
    query.error = function () {
      console.log('ERROR');
    };

  });

  start();

</script>
